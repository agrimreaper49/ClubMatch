{% include 'club_compass_app/header.html' %}
{% load socialaccount %}

<form id="when2meet_form" action="{% url 'send_when2meet' %}" method="post">
    {% csrf_token %}
    {% if error_message %}{{ error_message }}{% endif %}
<center>
    <div class="container p-3">
        <h2 class="display-4">Send When2Meet link!</h2>
        <div class="form-group">
            <label class="control-label"><h1 class="display-6"><small><strong>{{ form.event_name.label }}</strong></small></h1></label>
            {{ form.event_name }}
        </div>
        <!-- Start Time -->
            <div class='form-group'>
                <label class="control-label">{{ form.start_hour.label }}</label>
                {{ form.start_time.errors }}
                <div class="row">

                    <!-- Hours -->
                    <div class="col-sm-auto px-0">
                        <span class="d-inline-flex">
                            {{ form.start_hour }}
                        </span>
                        <span class="d-inline-flex">:</span>
                    </div>

                    <!-- AM/PM -->
                    <div class="col-sm-auto px-3">
                        {{ form.start_day_night }}
                    </div>
                </div>
            </div>

            <!-- End Time -->
            <div class='form-group'>
                <label class="control-label">{{ form.end_hour.label }}</label>
                {{ form.end_time.errors }}
                <div class="row">

                    <!-- Hours -->
                    <div class="col-sm-auto px-0">
                        <span class="d-inline-flex">
                            {{ form.end_hour }}
                        </span>
                        <span class="d-inline-flex">:</span>
                    </div>

                    <!-- AM/PM -->
                    <div class="col-sm-auto px-3">
                        {{ form.end_day_night }}
                    </div>
                </div>
            </div>

            <!-- Dates -->

            <div id="dates">
                <span hidden="hidden" id="invalid_dates">Invalid Dates</span>
            <div class='form-group' id="date0_group">

                <div class="row">
                    <div class="col-sm-auto px-0">
                        <span class="d-inline-flex">
                            <label class="control-label" for="dates" id="date0_label">Date 1: </label>
                            <input type="date" name="dates" id="date0" class="form-control" placeholder="YYYY-MM-DD" required id="id_date"/>
                        </span>
                    </div>
                </div>
            </div>
            <button type="button" id="add_date_btn">Add Date</button>
            </div>
    </div>
    <div class="container">
    <input type="submit" class="btn btn-success" value="Submit">
    </div>
</center>
</form>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
<script>
    current_max_date = 0;
    dates_div = document.getElementById("dates");
    add_date_btn = document.getElementById("add_date_btn");
    add_date_btn.addEventListener("click", ()=>{
        console.log("test")
        let next_date_group = document.getElementById("date" + current_max_date + "_group").cloneNode(true);
        let next_date_label = next_date_group.querySelector("#date" + current_max_date + "_label");
        let next_date_input = next_date_group.querySelector("#date" + current_max_date);
        ++current_max_date;
        next_date_group.id = "date" + current_max_date + "_group";
        next_date_label.id = "date" + current_max_date + "_label";
        next_date_label.innerText = "Date " + (current_max_date+1) +": ";
        next_date_input.id = "date" + current_max_date;
        next_date_input.value = "";

        dates_div.insertBefore(next_date_group, add_date_btn);
    });
</script>